# ğŸ¯ Only-Test æ™ºèƒ½åŒ–APKæµ‹è¯•æ¡†æ¶

## ğŸ¨ è®¾è®¡ç†å¿µ

**"è¯´å‡ºä½ çš„æµ‹è¯•éœ€æ±‚ï¼Œå‰©ä¸‹çš„äº¤ç»™AI"**

Only-Test æ˜¯ä¸€ä¸ªé©å‘½æ€§çš„ç§»åŠ¨ç«¯UIè‡ªåŠ¨åŒ–æµ‹è¯•æ¡†æ¶ï¼Œé€šè¿‡ JSON + Python åä½œæ¶æ„ï¼Œå®ç°äº†çœŸæ­£çš„ **"Write Once, Test Everywhere"**ã€‚

### ğŸ¤” ä¸ºä»€ä¹ˆè¦è®¾è®¡è¿™ä¸ªæ¡†æ¶ï¼Ÿ

#### **ä¼ ç»Ÿæµ‹è¯•æ¡†æ¶çš„ç—›ç‚¹**
- âŒ **ç¡¬ç¼–ç åæ ‡**: æ¢ä¸ªè®¾å¤‡å°±å¤±æ•ˆ
- âŒ **é™æ€é€»è¾‘**: æ— æ³•å¤„ç†åŠ¨æ€UIçŠ¶æ€  
- âŒ **å¤æ‚ç¼–ç¨‹**: éœ€è¦æ·±åšæŠ€æœ¯èƒŒæ™¯
- âŒ **ç»´æŠ¤å›°éš¾**: UIå˜æ›´éœ€è¦é‡å†™ä»£ç 
- âŒ **è·¨è®¾å¤‡å·®å¼‚**: åŒä¸€ç”¨ä¾‹åœ¨ä¸åŒè®¾å¤‡è¡¨ç°ä¸ä¸€è‡´

#### **Only-Test çš„åˆ›æ–°è§£å†³æ–¹æ¡ˆ**
- âœ… **æ™ºèƒ½é€‚é…**: è‡ªåŠ¨æ£€æµ‹è®¾å¤‡ä¿¡æ¯ï¼ŒåŠ¨æ€è°ƒæ•´ç­–ç•¥
- âœ… **æ¡ä»¶é€»è¾‘**: "å¦‚æœæœç´¢æ¡†æœ‰å†…å®¹å…ˆæ¸…ç©º" â†’ è‡ªåŠ¨è½¬æ¢ä¸ºæ¡ä»¶åˆ†æ”¯
- âœ… **è‡ªç„¶è¯­è¨€**: ç”¨æˆ·åªéœ€æè¿°æµ‹è¯•æ„å›¾ï¼Œæ— éœ€ç¼–ç¨‹
- âœ… **åŒæ¨¡è¯†åˆ«**: XML+è§†è§‰è¯†åˆ«æ™ºèƒ½åˆ‡æ¢ï¼Œé€‚åº”åŠ¨é™æ€åœºæ™¯
- âœ… **å®Œæ•´è¿½æº¯**: æ¯ä¸ªæ“ä½œéƒ½æœ‰å®Œæ•´çš„æ‰§è¡Œè½¨è¿¹è®°å½•

### ğŸ—ï¸ æ ¸å¿ƒæ¶æ„è®¾è®¡æ€æƒ³

```
è‡ªç„¶è¯­è¨€ â†’ LLMç†è§£ â†’ JSONæ™ºèƒ½å…ƒæ•°æ® â†’ Pythonæ‰§è¡Œä»£ç  â†’ æµ‹è¯•æŠ¥å‘Š
    â†“         â†“           â†“               â†“           â†“
   æ„å›¾      é€»è¾‘        å­˜å‚¨            æ‰§è¡Œ        ç»“æœ
```

#### **ä¸ºä»€ä¹ˆé€‰æ‹© JSON + Python åä½œï¼Ÿ**

**JSON ä½œä¸ºæ™ºèƒ½åª’ä»‹**ï¼š
- ğŸ“Š **ç»Ÿè®¡å‹å¥½**: ä¾¿äºç”¨ä¾‹ç®¡ç†å’Œæ•°æ®åˆ†æ
- ğŸ§  **AIå‹å¥½**: LLMå¯ä»¥ç›´æ¥ç†è§£å’Œç”Ÿæˆ
- ğŸ“ **äººç±»å¯è¯»**: éæŠ€æœ¯äººå‘˜ä¹Ÿèƒ½ç†è§£æµ‹è¯•é€»è¾‘
- ğŸ”„ **ç‰ˆæœ¬æ§åˆ¶**: Gitå‹å¥½ï¼Œä¾¿äºåä½œå’Œå›æº¯

**Python ä½œä¸ºæ‰§è¡Œè½½ä½“**ï¼š
- ğŸ **çµæ´»å¼ºå¤§**: æ”¯æŒå¤æ‚é€»è¾‘å’Œç‰¹æ®Šå‡½æ•°
- ğŸ§ª **ç”Ÿæ€ä¸°å¯Œ**: ä¸Airtest+Pytest+Allureæ— ç¼é›†æˆ
- ğŸ› **è°ƒè¯•å‹å¥½**: æ”¯æŒæ–­ç‚¹è°ƒè¯•å’Œå®æ—¶ä¿®æ”¹
- ğŸ”§ **æ‰©å±•æ€§å¼º**: æ˜“äºæ·»åŠ è‡ªå®šä¹‰åŠŸèƒ½

#### **ä¸ºä»€ä¹ˆéœ€è¦è®¾å¤‡å¯†åº¦(WM Density)é€‚é…ï¼Ÿ**

**æ ¸å¿ƒé—®é¢˜**: åŒæ ·çš„UIå…ƒç´ åœ¨ä¸åŒå¯†åº¦è®¾å¤‡ä¸Šå¤§å°å·®å¼‚å·¨å¤§

**è§£å†³æ–¹æ¡ˆ**: 
- ğŸ¯ **åæ ‡æ™ºèƒ½ç¼©æ”¾**: æ ¹æ®å¯†åº¦æ¯”ä¾‹è‡ªåŠ¨è°ƒæ•´è§¦æ‘¸åæ ‡
- ğŸ“¸ **æˆªå›¾è´¨é‡ä¼˜åŒ–**: é«˜å¯†åº¦è®¾å¤‡é™ä½è´¨é‡å‡å°‘å­˜å‚¨ï¼Œä½å¯†åº¦è®¾å¤‡æé«˜è´¨é‡ä¿è¯è¯†åˆ«
- ğŸ” **è¯†åˆ«é˜ˆå€¼è°ƒèŠ‚**: é«˜å¯†åº¦å›¾åƒè´¨é‡å¥½è®¾ç½®é«˜é˜ˆå€¼ï¼Œä½å¯†åº¦å›¾åƒå®½æ¾è¦æ±‚
- ğŸ“± **UIå…ƒç´ é¢„æµ‹**: é¢„æµ‹ä¸åŒè®¾å¤‡ä¸Šå…ƒç´ çš„å®é™…åƒç´ å¤§å°

## ğŸ”„ å®Œæ•´å·¥ä½œæµç¨‹

### **æ ¸å¿ƒ4æ­¥éª¤å·¥ä½œæµ**

```mermaid
flowchart LR
    A[è‡ªç„¶è¯­è¨€éœ€æ±‚] --> B[LLMç”ŸæˆJSON]
    B --> C[è®¾å¤‡ä¿¡æ¯æ¢æµ‹]
    C --> D[æ™ºèƒ½æ‰§è¡Œå¼•æ“]
    D --> E[èµ„æºæ•°æ®å›å†™]
    
    E --> F[JSONè½¬Python]
    F --> G[æµ‹è¯•æ‰§è¡Œ]
    G --> H[æŠ¥å‘Šç”Ÿæˆ]
```

#### **æ­¥éª¤1: æ™ºèƒ½ç”¨ä¾‹ç”Ÿæˆ**
```bash
# ç”¨æˆ·è¾“å…¥è‡ªç„¶è¯­è¨€
"åœ¨æŠ–éŸ³APPä¸­æœç´¢'ç¾é£Ÿè§†é¢‘'ï¼Œå¦‚æœæœç´¢æ¡†æœ‰å†å²è®°å½•å…ˆæ¸…ç©º"

# LLMè‡ªåŠ¨ç”Ÿæˆæ™ºèƒ½JSONç”¨ä¾‹
python tools/case_generator.py --description "æµ‹è¯•éœ€æ±‚" --app com.mobile.brasiltvmobile
```

#### **æ­¥éª¤2: è®¾å¤‡ä¿¡æ¯æ¢æµ‹ä¸é€‚é…**
```bash
# è‡ªåŠ¨æ¢æµ‹è®¾å¤‡ä¿¡æ¯å¹¶æ›´æ–°JSON
python lib/device_adapter.py testcase.json

# ç»“æœ: JSONä¸­è‡ªåŠ¨æ·»åŠ è®¾å¤‡é€‚é…ä¿¡æ¯
{
  "device_adaptation": {
    "detected_device": {"density": 560, "resolution": "3120x1440"},
    "adaptation_rules": {"coordinate_scaling": 1.33, "screenshot_quality": 75}
  }
}
```

#### **æ­¥éª¤3: æ™ºèƒ½æ‰§è¡Œä¸èµ„æºä¿å­˜**
```bash
# æ‰§è¡Œæµ‹è¯•å¹¶ä¿å­˜å®Œæ•´èµ„æº
python tools/test_runner.py --file testcase.json

# èµ„æºä¿å­˜è·¯å¾„è§„åˆ™: assets/{pkg_name}_{device_name}/
# ç¤ºä¾‹: assets/com_ss_android_ugc_aweme_Pixel6Pro/
#   â”œâ”€â”€ step01_click_before_20241205_143022.png
#   â”œâ”€â”€ step02_conditional_action_after_20241205_143035.png  
#   â”œâ”€â”€ step02_omni_result_20241205_143032.json
#   â””â”€â”€ execution_log.jsonl
```

#### **æ­¥éª¤4: æ•°æ®å›å†™ä¸ä»£ç ç”Ÿæˆ**
```bash
# æ‰§è¡Œç»“æœè‡ªåŠ¨å›å†™åˆ°JSON (ç›¸å¯¹è·¯å¾„)
# JSONä¸­æ·»åŠ  execution_assets éƒ¨åˆ†è®°å½•æ‰€æœ‰èµ„æº

# JSONè½¬æ¢ä¸ºPythonä»£ç 
python lib/code_generator/json_to_python.py testcase.json

# ç”Ÿæˆæ”¯æŒ Airtest + Pytest + Allure çš„Pythonæ–‡ä»¶
```

## ğŸ§  æ™ºèƒ½ç‰¹æ€§è¯¦è§£

### **æ¡ä»¶åˆ†æ”¯é€»è¾‘**

**ç”¨æˆ·æè¿°**: "å¦‚æœæœç´¢æ¡†æœ‰å†…å®¹å…ˆæ¸…ç©º"
**è‡ªåŠ¨è½¬æ¢ä¸º**:
```json
{
  "action": "conditional_action",
  "condition": {
    "type": "element_content_check", 
    "target": "search_input_box",
    "check": "has_text_content"
  },
  "conditional_paths": {
    "if_has_content": {"action": "click", "target": "clear_button"},
    "if_empty": {"action": "input", "data": "æœç´¢è¯"}
  }
}
```

### **åŒæ¨¡å¼è¯†åˆ«ç­–ç•¥**

**é™æ€ç•Œé¢**: ä½¿ç”¨XMLè¯†åˆ« (å¿«é€Ÿã€å‡†ç¡®)
```python
if not is_media_playing():
    element = poco(resourceId="search_input").click()
```

**è§†é¢‘æ’­æ”¾**: ä½¿ç”¨Omniparserè§†è§‰è¯†åˆ«
```python 
if is_media_playing():
    omni_result = omniparser.recognize(screenshot)
    click_element_by_visual(omni_result.elements[0])
```

### **èµ„æºè·¯å¾„ç®¡ç†è§„åˆ™**

**å‘½åè§„èŒƒ**: `{pkg_name}_{device_name}`
- `com.mobile.brasiltvmobile` + `Pixel_6_Pro` = `com_ss_android_ugc_aweme_Pixel6Pro`
- æ—¶é—´æˆ³ç²¾ç¡®åˆ°æ¯«ç§’: `step01_click_before_20241205_143022_123.png`
- æ–‡ä»¶ç±»å‹æ˜ç¡®: `omni_result`, `element_screenshot`, `execution_log`

**å­˜å‚¨ç»“æ„**:
```
assets/
â”œâ”€â”€ com_ss_android_ugc_aweme_Pixel6Pro/     # æŠ–éŸ³+Pixel6Pro
â”œâ”€â”€ com_taobao_taobao_XiaomiPhone/          # æ·˜å®+å°ç±³æ‰‹æœº
â””â”€â”€ com_netease_cloudmusic_HuaweiMate/      # ç½‘æ˜“äº‘+åä¸ºMate
```

## ğŸ“ ç›®å½•ç»“æ„è¯´æ˜

```
only_test/
â”œâ”€â”€ ğŸ“ lib/                                    # æ ¸å¿ƒåº“æ–‡ä»¶
â”‚   â”œâ”€â”€ ğŸ“ phone_use_core/                     # phone-use æ ¸å¿ƒåŠŸèƒ½é›†æˆ
â”‚   â”œâ”€â”€ ğŸ“ metadata_engine/                   # æ™ºèƒ½å…ƒæ•°æ®å¤„ç†
â”‚   â”œâ”€â”€ ğŸ“ execution_engine/                  # æ‰§è¡Œå¼•æ“
â”‚   â”œâ”€â”€ ğŸ“ code_generator/                    # JSONè½¬Pythonè½¬æ¢å™¨
â”‚   â”œâ”€â”€ ğŸ“ device_adapter.py                 # è®¾å¤‡ä¿¡æ¯æ¢æµ‹ä¸é€‚é…
â”‚   â””â”€â”€ ğŸ“ assets_manager.py                 # èµ„æºç®¡ç†å™¨
â”œâ”€â”€ ğŸ“ testcases/                             # æµ‹è¯•ç”¨ä¾‹ç›®å½•
â”‚   â”œâ”€â”€ ğŸ“ templates/                         # ç”¨ä¾‹æ¨¡æ¿
â”‚   â”œâ”€â”€ ğŸ“ generated/                         # LLM ç”Ÿæˆçš„ç”¨ä¾‹
â”‚   â”œâ”€â”€ ğŸ“ python/                           # è½¬æ¢åçš„Pythonç”¨ä¾‹
â”‚   â””â”€â”€ ğŸ“ manual/                           # æ‰‹åŠ¨ç¼–å†™çš„ç”¨ä¾‹
â”œâ”€â”€ ğŸ“ assets/                               # æµ‹è¯•èµ„æºæ–‡ä»¶
â”‚   â”œâ”€â”€ ğŸ“ {app}_{device}/                   # æŒ‰åº”ç”¨+è®¾å¤‡åˆ†ç±»
â”‚   â””â”€â”€ ...
â”œâ”€â”€ ğŸ“ tools/                                # å¼€å‘å·¥å…·
â”‚   â”œâ”€â”€ case_generator.py                    # ç”¨ä¾‹ç”Ÿæˆå·¥å…·
â”‚   â”œâ”€â”€ test_runner.py                       # æµ‹è¯•è¿è¡Œå·¥å…·
â”‚   â””â”€â”€ test_executor.py                     # é›†æˆæ‰§è¡Œå·¥å…·
â”œâ”€â”€ ğŸ“ examples/                             # ç¤ºä¾‹å’Œæ¼”ç¤º
â”‚   â””â”€â”€ complete_workflow_demo.py            # å®Œæ•´å·¥ä½œæµæ¼”ç¤º
â”œâ”€â”€ ğŸ“ config/                               # é…ç½®æ–‡ä»¶
â”œâ”€â”€ ğŸ“ reports/                              # æµ‹è¯•æŠ¥å‘Š
â””â”€â”€ README.md                                # æœ¬è¯´æ˜æ–‡ä»¶
```

## ğŸš€ å¿«é€Ÿä¸Šæ‰‹

### **ä¸€é”®ä½“éªŒå®Œæ•´å·¥ä½œæµ**
```bash
# è¿è¡Œå®Œæ•´å·¥ä½œæµç¨‹æ¼”ç¤º
python examples/complete_workflow_demo.py

# é€‰æ‹©æµ‹è¯•åœºæ™¯:
# 1. åœ¨æŠ–éŸ³APPä¸­æœç´¢'ç¾é£Ÿè§†é¢‘'ï¼Œå¦‚æœæœç´¢æ¡†æœ‰å†å²è®°å½•å…ˆæ¸…ç©º
# 2. åœ¨æ·˜å®ä¸­æœç´¢'iPhone 15'ï¼Œå¦‚æœæœ‰æœç´¢å†å²å…ˆæ¸…ç©ºï¼Œç‚¹å‡»ç¬¬ä¸€ä¸ªå•†å“
# 3. åœ¨ç½‘æ˜“äº‘éŸ³ä¹ä¸­æœç´¢'å‘¨æ°ä¼¦'ï¼Œå¦‚æœæœç´¢æ¡†æœ‰å†…å®¹å…ˆæ¸…ç©ºå†è¾“å…¥
```

### **åˆ†æ­¥æ“ä½œ**
```bash
# æ­¥éª¤1: ç”Ÿæˆæ™ºèƒ½JSONç”¨ä¾‹
python tools/case_generator.py \
  --description "åœ¨æŠ–éŸ³APPä¸­æœç´¢'ç¾é£Ÿè§†é¢‘'ï¼Œå¦‚æœæœç´¢æ¡†æœ‰å†å²è®°å½•å…ˆæ¸…ç©º" \
  --app com.mobile.brasiltvmobile

# æ­¥éª¤2: æ¢æµ‹è®¾å¤‡ä¿¡æ¯å¹¶é€‚é…
python lib/device_adapter.py testcases/generated/generated_test.json

# æ­¥éª¤3-4: æ‰§è¡Œæµ‹è¯•å¹¶ä¿å­˜èµ„æº
python tools/test_runner.py --file testcases/generated/generated_test.json

# æ­¥éª¤5-7: JSONè½¬Python + æ‰§è¡Œ + ç”ŸæˆæŠ¥å‘Š
python tools/test_executor.py --files testcases/generated/generated_test.json
```

### **æŸ¥çœ‹ç»“æœ**
```bash
# æŸ¥çœ‹ç”Ÿæˆçš„èµ„æºæ–‡ä»¶
ls -la assets/com_ss_android_ugc_aweme_*/

# æŸ¥çœ‹Pythonæµ‹è¯•ä»£ç 
cat testcases/python/test_*.py

# æ‰“å¼€Allureæµ‹è¯•æŠ¥å‘Š
allure open reports/allure-report
```

## ğŸ“š æŠ€æœ¯æ ˆ

### **æ ¸å¿ƒä¾èµ–**
- **Airtest**: ç§»åŠ¨ç«¯UIè‡ªåŠ¨åŒ–æµ‹è¯•
- **Pytest**: Pythonæµ‹è¯•æ¡†æ¶
- **Allure**: æµ‹è¯•æŠ¥å‘Šç”Ÿæˆ
- **Poco**: UIå…ƒç´ å®šä½å’Œæ“ä½œ
- **Jinja2**: æ¨¡æ¿å¼•æ“ç”¨äºä»£ç ç”Ÿæˆ

### **AIé›†æˆ**
- **LLM**: è‡ªç„¶è¯­è¨€ç†è§£å’Œç”¨ä¾‹ç”Ÿæˆ
- **Omniparser**: è§†è§‰è¯†åˆ«å¼•æ“
- **æ¡ä»¶é€»è¾‘å¼•æ“**: æ™ºèƒ½åˆ†æ”¯åˆ¤æ–­

### **è®¾å¤‡æ§åˆ¶**
- **ADB**: Androidè°ƒè¯•æ¡¥
- **UIAutomator2**: Android UIè‡ªåŠ¨åŒ–
- **Phone-Use**: å±å¹•æ§åˆ¶å’Œä¿¡æ¯è·å–

## ğŸ¯ æ ¸å¿ƒä¼˜åŠ¿

### **ğŸ§  æ™ºèƒ½åŒ–**
- è‡ªç„¶è¯­è¨€ â†’ æµ‹è¯•ç”¨ä¾‹
- æ¡ä»¶åˆ†æ”¯è‡ªåŠ¨åˆ¤æ–­ 
- è®¾å¤‡ä¿¡æ¯æ™ºèƒ½é€‚é…
- è¯†åˆ«æ¨¡å¼æ™ºèƒ½åˆ‡æ¢

### **ğŸ“Š æ ‡å‡†åŒ–**
- JSONæ™ºèƒ½å…ƒæ•°æ®ç»Ÿä¸€æ ¼å¼
- èµ„æºè·¯å¾„è§„èŒƒåŒ–ç®¡ç†
- Pythonä»£ç æ¨¡æ¿åŒ–ç”Ÿæˆ
- æµ‹è¯•æŠ¥å‘Šæ ‡å‡†åŒ–è¾“å‡º

### **ğŸ”„ è‡ªåŠ¨åŒ–**
- å®Œæ•´å·¥ä½œæµä¸€é”®æ‰§è¡Œ
- è®¾å¤‡å·®å¼‚è‡ªåŠ¨å¤„ç†
- æ‰§è¡Œè¿‡ç¨‹å…¨ç¨‹è®°å½•
- å¼‚å¸¸æƒ…å†µè‡ªåŠ¨æ¢å¤

### **ğŸš€ æ‰©å±•æ€§**
- æ¨¡å—åŒ–æ¶æ„æ˜“äºæ‰©å±•
- æ’ä»¶åŒ–LLMé›†æˆ
- æ¨¡æ¿åŒ–ç”¨ä¾‹ç”Ÿæˆ
- APIåŒ–æ¥å£è°ƒç”¨

## ğŸ“– è¯¦ç»†æ–‡æ¡£

- **å·¥ä½œæµç¨‹æŒ‡å—**: [WORKFLOW_GUIDE.md](WORKFLOW_GUIDE.md) - é€šä¿—æ˜“æ‡‚çš„å®Œæ•´å·¥ä½œæµç¨‹è¯´æ˜
- **åä½œæ¶æ„è¯´æ˜**: [COLLABORATION_ARCHITECTURE.md](COLLABORATION_ARCHITECTURE.md) - JSON+Pythonåä½œæ¶æ„æ·±åº¦è§£æ
- **ä½¿ç”¨æ•™ç¨‹**: [USAGE_GUIDE.md](USAGE_GUIDE.md) - è¯¦ç»†çš„ä½¿ç”¨æ•™ç¨‹å’Œé…ç½®è¯´æ˜
- **æœ€ç»ˆæ€»ç»“**: [FINAL_WORKFLOW_SUMMARY.md](FINAL_WORKFLOW_SUMMARY.md) - é¡¹ç›®å®Œæ•´æ€»ç»“å’ŒæŠ€æœ¯äº®ç‚¹

## ğŸ‰ æ€»ç»“

**Only-Test** é€šè¿‡åˆ›æ–°çš„ **JSON + Python åä½œæ¶æ„**ï¼ŒçœŸæ­£å®ç°äº†ï¼š

- âœ… **"Write Once, Test Everywhere"** - ä¸€æ¬¡ç¼–å†™ï¼Œå¤šè®¾å¤‡æ‰§è¡Œ
- âœ… **"Say What You Want"** - è‡ªç„¶è¯­è¨€æè¿°æµ‹è¯•éœ€æ±‚
- âœ… **"AI Does The Rest"** - AIå¤„ç†å¤æ‚é€»è¾‘å’Œè®¾å¤‡å·®å¼‚
- âœ… **"Complete Traceability"** - å®Œæ•´çš„æ‰§è¡Œè½¨è¿¹å’Œèµ„æºç®¡ç†

è¿™å°±æ˜¯ç§»åŠ¨ç«¯UIè‡ªåŠ¨åŒ–æµ‹è¯•çš„æœªæ¥ï¼ğŸš€

---

*Based on Airtest framework, integrated with phone-use functionality, supporting LLM-driven test case generation and execution.*


----

