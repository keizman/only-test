{
  "testcase_id": "TEMPLATE_SMART_SEARCH_001",
  "name": "智能搜索功能测试模板",
  "version": "2.0.0",
  "description": "演示智能条件判断的搜索用例模板，基于搜索框状态智能选择操作路径",
  "metadata": {
    "tags": ["search", "smart_judgment", "conditional", "template"],
    "priority": "high",
    "estimated_duration": 60,
    "device_types": ["android_phone", "android_tv"],
    "app_versions": [">=3.0.0"],
    "complexity": "conditional_logic",
    "ai_friendly": true,
    "author": "Only-Test Framework",
    "template_version": "1.0"
  },
  "context_awareness": {
    "current_app_state": "launched",
    "expected_page": "search_page", 
    "user_session": "anonymous",
    "network_status": "connected",
    "prerequisites": [
      "应用已启动",
      "网络连接正常",
      "用户未登录状态"
    ]
  },
  "variables": {
    "search_keyword": "${test_program_name}",
    "max_wait_time": 30,
    "expected_results_count": ">= 1"
  },
  "execution_path": [
    {
      "step": 1,
      "page": "home",
      "action": "click",
      "target": {
        "priority_selectors": [
          {"resource_id": "search_button"},
          {"content_desc": "搜索"},
          {"text": "搜索"},
          {"visual_hint": "搜索图标"}
        ]
      },
      "description": "点击首页搜索按钮",
      "success_criteria": "成功进入搜索页面",
      "ai_hint": "寻找搜索图标、放大镜符号或'搜索'文字",
      "timeout": 10,
      "retry_count": 2
    },
    {
      "step": 2,
      "page": "search_page", 
      "action": "conditional_action",
      "condition": {
        "type": "element_content_check",
        "target": {
          "priority_selectors": [
            {"resource_id": "search_input"},
            {"resource_id": "search_box"},
            {"class": "android.widget.EditText"},
            {"xpath": "//input[@type='search']"}
          ]
        },
        "check": "has_text_content",
        "params": {
          "ignore_placeholder": true,
          "trim_whitespace": true
        }
      },
      "conditional_paths": {
        "if_has_content": {
          "action": "click",
          "target": {
            "priority_selectors": [
              {"resource_id": "clear_button"},
              {"resource_id": "cancel_button"}, 
              {"content_desc": "清除"},
              {"text": "×"},
              {"visual_hint": "清除按钮"}
            ]
          },
          "reason": "搜索框已有内容，需要先清空以输入新的搜索词",
          "ai_hint": "寻找清除按钮、×符号、取消按钮或清空图标",
          "success_criteria": "搜索框内容被清空",
          "fallback_action": {
            "action": "long_press_and_select_all",
            "target": "search_input_box",
            "follow_up": "input_text",
            "data": ""
          }
        },
        "if_empty": {
          "action": "input",
          "target": "search_input_box",
          "data": "${search_keyword}",
          "reason": "搜索框为空，直接输入搜索关键词",
          "ai_hint": "直接在输入框中输入文本",
          "success_criteria": "搜索词成功输入到搜索框中"
        }
      },
      "description": "根据搜索框内容状态智能选择操作：有内容则清空，无内容则直接输入",
      "business_logic": "确保搜索框处于正确状态，避免搜索词混乱或重复",
      "ai_understanding": "这是一个典型的条件判断场景，AI需要先观察搜索框状态再决定操作",
      "common_issues": [
        "搜索框可能有占位符文本",
        "不同应用的清除按钮位置不同",
        "可能需要多次点击才能完全清空"
      ]
    },
    {
      "step": 3,
      "page": "search_page",
      "action": "conditional_action",
      "condition": {
        "type": "element_content_check",
        "target": "search_input_box",
        "check": "is_empty"
      },
      "conditional_paths": {
        "if_true": {
          "action": "input",
          "target": "search_input_box", 
          "data": "${search_keyword}",
          "reason": "搜索框已清空，现在输入搜索词"
        },
        "if_false": {
          "action": "skip",
          "reason": "搜索框已有正确内容，跳过输入步骤"
        }
      },
      "description": "确保搜索词正确输入",
      "success_criteria": "搜索框包含目标搜索词"
    },
    {
      "step": 4,
      "page": "search_page",
      "action": "click",
      "target": {
        "priority_selectors": [
          {"resource_id": "search_confirm"},
          {"resource_id": "search_submit"},
          {"content_desc": "搜索"},
          {"text": "搜索"},
          {"visual_hint": "搜索按钮"}
        ]
      },
      "description": "点击搜索确认按钮执行搜索",
      "precondition": "搜索框已有内容",
      "ai_hint": "寻找搜索按钮、确认按钮或放大镜图标",
      "success_criteria": "搜索请求成功发送，开始加载搜索结果",
      "timeout": 15
    },
    {
      "step": 5,
      "page": "search_results",
      "action": "wait_for_elements",
      "target": {
        "selectors": [
          {"class": "search_result_item"},
          {"resource_id": "result_list"},
          {"xpath": "//div[@class='search-results']"}
        ]
      },
      "description": "等待搜索结果加载完成",
      "timeout": "${max_wait_time}",
      "success_criteria": "搜索结果列表显示"
    }
  ],
  "assertions": [
    {
      "step": 5,
      "type": "check_search_results_exist",
      "expected": true,
      "timeout": 10,
      "description": "验证搜索结果正常显示",
      "ai_understanding": "确认搜索功能工作正常，用户能看到搜索结果",
      "error_handling": "如果无结果，检查网络连接和搜索词是否正确"
    },
    {
      "step": 5,
      "type": "check_results_count",
      "expected": "${expected_results_count}",
      "description": "验证搜索结果数量符合预期",
      "tolerance": "至少有一个搜索结果"
    }
  ],
  "ai_enhancement": {
    "nlp_keywords": [
      "搜索", "输入", "清空", "确认", "结果", 
      "关键词", "查询", "筛选", "匹配"
    ],
    "visual_cues": [
      "搜索图标", "放大镜", "输入框", "清除按钮", 
      "×符号", "搜索按钮", "结果列表"
    ],
    "user_intent": "用户想要搜索特定内容并查看结果",
    "workflow_patterns": [
      "观察搜索框状态 → 选择清空或直接输入 → 确认搜索 → 查看结果"
    ],
    "decision_points": [
      "搜索框是否有内容？",
      "清空操作是否成功？", 
      "搜索词是否正确输入？",
      "搜索结果是否正常加载？"
    ],
    "common_variations": [
      "搜索框可能已有历史内容",
      "不同APP的搜索按钮样式不同",
      "可能需要先清空再输入",
      "搜索可能需要联网验证"
    ],
    "error_patterns": [
      "搜索框被键盘遮挡",
      "网络异常导致搜索失败", 
      "搜索结果为空",
      "搜索按钮不响应"
    ]
  },
  "llm_generation_hints": {
    "core_logic": "智能判断搜索框状态 → 选择对应清理策略 → 输入搜索词 → 执行搜索 → 验证结果",
    "decision_points": [
      "搜索框内容状态检查",
      "清空策略选择",
      "输入确认"
    ],
    "alternative_flows": [
      "直接输入流程（搜索框为空）",
      "清空后输入流程（搜索框有内容）",
      "覆盖输入流程（长按全选后输入）"
    ],
    "success_indicators": [
      "搜索框状态正确",
      "搜索词输入成功",
      "搜索结果列表显示"
    ],
    "context_dependencies": [
      "需要在搜索页面",
      "需要网络连接",
      "应用需要有搜索权限"
    ],
    "complexity_factors": [
      "条件分支逻辑",
      "多种元素定位策略",
      "状态依赖的操作序列"
    ]
  },
  "recovery_actions": [
    {
      "exception": "element_content_unclear",
      "action": "use_visual_recognition",
      "reason": "XML无法准确获取输入框内容时启用视觉识别",
      "fallback": "force_clear_and_input"
    },
    {
      "exception": "conditional_logic_failed", 
      "action": "fallback_to_clear_and_input",
      "reason": "判断逻辑失败时强制执行清空后输入的流程"
    },
    {
      "exception": "search_timeout",
      "action": "retry_search",
      "params": {"max_retries": 2, "delay": 3}
    },
    {
      "exception": "no_search_results",
      "action": "verify_network_and_retry", 
      "reason": "可能是网络问题或搜索词问题"
    }
  ],
  "template_usage": {
    "how_to_use": "将此模板复制到具体项目中，根据实际应用修改元素选择器和业务逻辑",
    "customization_points": [
      "修改 variables 中的搜索关键词",
      "更新 target 中的元素选择器",
      "调整超时时间和重试次数",
      "添加应用特定的断言"
    ],
    "llm_prompt_template": "基于此模板生成用例时，请保持条件判断逻辑的完整性，确保AI能理解每个决策点的含义"
  }
}