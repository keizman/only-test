# Only-Test ç»¼åˆæŠ€æœ¯æ–‡æ¡£

## æ–‡æ¡£è¯´æ˜

æœ¬æ–‡æ¡£æ•´åˆäº†é¡¹ç›®ä¸­æ‰€æœ‰åˆ†æ•£çš„æŠ€æœ¯æ–‡æ¡£ï¼Œæä¾›å®Œæ•´çš„æŠ€æœ¯å‚è€ƒã€‚æ ¹æ®åˆå¹¶ç­–ç•¥ï¼Œå½“å†…å®¹å†²çªæ—¶ä¿ç•™æè¿°æ›´è¯¦ç»†çš„ç‰ˆæœ¬ã€‚

---

# 1. Only-Test è‡ªåŠ¨åŒ–æµ‹è¯•æ¡†æ¶

## 1.1 é¡¹ç›®æ„¿æ™¯

### ä¸ºä»€ä¹ˆè¦ Only-Test

ä½¿ç”¨ Airtest èƒ½å¾ˆå¿«çš„å†™å‡ºä¸€ä»½ APK çš„è‡ªåŠ¨åŒ–ç”¨ä¾‹ï¼Œä¸ºä»€ä¹ˆè¿˜è¦èŠ±æ—¶é—´æ¥æ‰“é€ è¿™æ ·ä¸€ä¸ªè‡ªåŠ¨åŒ–æµ‹è¯•æ¡†æ¶ï¼Ÿ

å¯¹æˆ‘ä»¬è€Œè¨€æœ‰ç”¨çš„ UI è‡ªåŠ¨åŒ–ç”¨ä¾‹è‡³å°‘è¦èƒ½è·¨ APK æµ‹è¯•ã€‚å¯å³ä½¿èƒ½å†™å‡ºä¸€ä»½ï¼Œéš¾é“é‚£ä¹ˆå¤šä»½éƒ½è¦æ‰‹åŠ¨å†™å—ï¼Ÿ

è¿™æ ·å†™å‡ºæ¥çš„ç”¨ä¾‹ä¸å…·å¤‡é€šç”¨æ€§ï¼ŒAirtest æœ‰ Poco(å…ƒç´  ID) è§†è§‰ä¸¤ç§è¯†åˆ«æ¨¡å¼ï¼Œå³ä½¿å®Œå…¨ä½¿ç”¨ Poco å®šä½ä¹Ÿä¼šé‡åˆ°è·¨ APK æ—¶å…ƒç´  name æ”¹å˜åæ— æ³•å‡†ç¡®å®šä½çš„é—®é¢˜ã€‚

### æ ¸å¿ƒé—®é¢˜

**UI å®šä½çš„ç¼ºé™·ï¼š**
1. æ— æ³•è·¨è®¾å¤‡
2. æ— æ³•è·¨ APK
3. æ›´æ— æ³•è·¨è¶Š TV ä¸ æ‰‹æœº

**ä¼ ç»Ÿæ–¹æ¡ˆé—®é¢˜ï¼š**
- æ¯ä¸ª APK éƒ½éœ€è¦å•ç‹¬å¼€å‘æµ‹è¯•ç”¨ä¾‹
- å…ƒç´  ID æ”¹å˜å¯¼è‡´æµ‹è¯•ç”¨ä¾‹å¤±æ•ˆ
- æ— æ³•åœ¨ä¸åŒè®¾å¤‡é—´è¿è¡Œ
- æ’­æ”¾çŠ¶æ€ä¸‹æ— æ³•è®¿é—® UI æ§ä»¶
- DRM ä¿æŠ¤å¯¼è‡´ TV ç«¯æ— æ³•æˆªå›¾

---

# 2. æ¡†æ¶æ¶æ„è®¾è®¡

## 2.1 æ ¸å¿ƒè®¾è®¡ç†å¿µ

**"å‘Šè¯‰AIä½ æƒ³æµ‹ä»€ä¹ˆï¼ŒAIå¸®ä½ å®Œæˆä¸€åˆ‡"**

Only-Test åŸºäº **JSON + Python åä½œæ¶æ„** è®¾è®¡ï¼Œé€šè¿‡ç»Ÿä¸€çš„é…ç½®ç®¡ç†ç³»ç»Ÿå’Œæ™ºèƒ½LLMé›†æˆï¼Œå®ç°äº†å®Œå…¨è‡ªåŠ¨åŒ–çš„ç§»åŠ¨ç«¯UIæµ‹è¯•æ¡†æ¶ã€‚

- **é…ç½®é©±åŠ¨**: é€šè¿‡ YAML é…ç½®æ–‡ä»¶ç®¡ç†è®¾å¤‡ã€åº”ç”¨å’Œæµ‹è¯•å¥—ä»¶ä¿¡æ¯
- **æ™ºèƒ½ç”Ÿæˆ**: LLM è‡ªåŠ¨å°†è‡ªç„¶è¯­è¨€è½¬æ¢ä¸ºç»“æ„åŒ–æµ‹è¯•ç”¨ä¾‹
- **åŒæ¨¡è¯†åˆ«**: XML å’Œè§†è§‰è¯†åˆ«æ™ºèƒ½åˆ‡æ¢ï¼Œé€‚åº”ä¸åŒåº”ç”¨åœºæ™¯
- **å®Œæ•´è¿½æº¯**: æ‰€æœ‰æ‰§è¡Œè¿‡ç¨‹å’Œèµ„æºéƒ½æœ‰å®Œæ•´çš„è®°å½•å’Œç®¡ç†

## 2.2 ç³»ç»Ÿæ¶æ„å›¾

```mermaid
graph TB
    subgraph "ç”¨æˆ·æ¥å£å±‚"
        A[è‡ªç„¶è¯­è¨€æè¿°] --> B[å‘½ä»¤è¡Œå·¥å…·]
        B --> C[é›†æˆå·¥ä½œæµ]
    end
    
    subgraph "é…ç½®ç®¡ç†å±‚"
        D[ConfigManager] --> E[main.yaml]
        D --> F[.env]
        D --> G[è®¾å¤‡ç¼“å­˜]
    end
    
    subgraph "AIæœåŠ¡å±‚"
        H[LLMClient] --> I[OpenAI Compatible]
        H --> J[Claude]
        H --> K[OpenAI Official]
    end
    
    subgraph "æ‰§è¡Œå¼•æ“å±‚"  
        L[SmartExecutor] --> M[XMLè¯†åˆ«]
        L --> N[è§†è§‰è¯†åˆ«]
        L --> O[æ¡ä»¶åˆ†æ”¯]
    end
    
    subgraph "èµ„æºç®¡ç†å±‚"
        P[AssetsManager] --> Q[æˆªå›¾ç®¡ç†]
        P --> R[æ‰§è¡Œæ—¥å¿—]
        P --> S[è¯†åˆ«ç»“æœ]
    end
    
    subgraph "ä»£ç ç”Ÿæˆå±‚"
        T[JSONToPython] --> U[Airtestä»£ç ]
        T --> V[Pytestæ¡†æ¶]
        T --> W[AllureæŠ¥å‘Š]
    end
    
    B --> D
    B --> H
    D --> L
    H --> L
    L --> P
    L --> T
    P --> T
```

## 2.3 ç›®å½•ç»“æ„ä¸èŒè´£

```
airtest/
â”œâ”€â”€ ğŸ“ lib/                           # æ ¸å¿ƒåº“æ–‡ä»¶
â”‚   â”œâ”€â”€ ğŸ“„ config_manager.py          # é…ç½®ç®¡ç†å™¨ - ç»Ÿä¸€é…ç½®è®¿é—®å…¥å£
â”‚   â”œâ”€â”€ ğŸ“ llm_integration/           # LLMé›†æˆæ¨¡å—
â”‚   â”‚   â””â”€â”€ ğŸ“„ llm_client.py          # å¤šæä¾›å•†LLMå®¢æˆ·ç«¯
â”‚   â”œâ”€â”€ ğŸ“ phone_use_core/            # phone-use æ ¸å¿ƒåŠŸèƒ½
â”‚   â”œâ”€â”€ ğŸ“ metadata_engine/           # æ™ºèƒ½å…ƒæ•°æ®å¤„ç†
â”‚   â”œâ”€â”€ ğŸ“ execution_engine/          # æ™ºèƒ½æ‰§è¡Œå¼•æ“
â”‚   â”œâ”€â”€ ğŸ“ code_generator/            # JSONåˆ°Pythonä»£ç è½¬æ¢
â”‚   â”œâ”€â”€ ğŸ“„ device_adapter.py          # è®¾å¤‡ä¿¡æ¯æ¢æµ‹ä¸é€‚é…
â”‚   â””â”€â”€ ğŸ“„ assets_manager.py          # èµ„æºæ–‡ä»¶ç»Ÿä¸€ç®¡ç†
â”œâ”€â”€ ğŸ“ testcases/                     # æµ‹è¯•ç”¨ä¾‹ç›®å½•
â”‚   â”œâ”€â”€ ğŸ“„ main.yaml                  # ä¸»é…ç½®æ–‡ä»¶ - è®¾å¤‡/åº”ç”¨/å¥—ä»¶é…ç½®
â”‚   â”œâ”€â”€ ğŸ“ templates/                 # ç”¨ä¾‹æ¨¡æ¿
â”‚   â”œâ”€â”€ ğŸ“ generated/                 # LLMç”Ÿæˆçš„JSONç”¨ä¾‹
â”‚   â”œâ”€â”€ ğŸ“ python/                    # è½¬æ¢åçš„Pythonç”¨ä¾‹
â”‚   â””â”€â”€ ğŸ“ manual/                    # æ‰‹åŠ¨ç¼–å†™çš„ç”¨ä¾‹
â”œâ”€â”€ ğŸ“ tools/                         # å¼€å‘å·¥å…·
â”‚   â”œâ”€â”€ ğŸ“„ case_generator.py          # æ™ºèƒ½ç”¨ä¾‹ç”Ÿæˆå·¥å…·
â”‚   â”œâ”€â”€ ğŸ“„ test_runner.py             # æµ‹è¯•è¿è¡Œå™¨
â”‚   â”œâ”€â”€ ğŸ“„ test_executor.py           # é›†æˆæ‰§è¡Œå™¨
â”‚   â””â”€â”€ ğŸ“„ integration_check.py       # æ¶æ„é›†æˆæ£€æŸ¥å·¥å…·
â”œâ”€â”€ ğŸ“ assets/                        # æµ‹è¯•èµ„æºæ–‡ä»¶
â”‚   â””â”€â”€ ğŸ“ {app}_{device}/            # æŒ‰åº”ç”¨+è®¾å¤‡åˆ†ç±»çš„èµ„æº
â”œâ”€â”€ ğŸ“ reports/                       # æµ‹è¯•æŠ¥å‘Š
â”œâ”€â”€ ğŸ“„ .env                           # ç¯å¢ƒå˜é‡é…ç½®
â””â”€â”€ ğŸ“„ README.md                      # é¡¹ç›®è¯´æ˜æ–‡æ¡£
```

---

# 3. å®Œæ•´å·¥ä½œæµç¨‹

## 3.1 å·¥ä½œæµç¨‹å›¾

```
è‡ªç„¶è¯­è¨€æµ‹è¯•éœ€æ±‚ â†’ LLMç”ŸæˆJSONç”¨ä¾‹ â†’ è®¾å¤‡ä¿¡æ¯æ¢æµ‹ â†’ æ™ºèƒ½æ‰§è¡Œæµ‹è¯• â†’ ç»“æœå›å†™ä¼˜åŒ– â†’ æŠ¥å‘Šç”Ÿæˆ
    â†“              â†“              â†“            â†“            â†“            â†“
   è¾“å…¥           æ™ºèƒ½å…ƒæ•°æ®        è®¾å¤‡é€‚é…      è§†è§‰è¯†åˆ«      å­¦ä¹ ä¼˜åŒ–      å¯è§†åŒ–æŠ¥å‘Š
```

## 3.2 è¯¦ç»†å·¥ä½œæµç¨‹

### æ­¥éª¤1ï¸âƒ£: æ–°APKæ–°ç”¨ä¾‹ - LLMæ™ºèƒ½ç”Ÿæˆ

**ç”¨æˆ·è¾“å…¥**ï¼ˆè‡ªç„¶è¯­è¨€ï¼‰ï¼š
```
"åœ¨æŠ–éŸ³APPä¸­æœç´¢'ç¾é£Ÿè§†é¢‘'ï¼Œå¦‚æœæœç´¢æ¡†æœ‰å†å²è®°å½•å…ˆæ¸…ç©ºï¼Œç„¶åç‚¹å‡»ç¬¬ä¸€ä¸ªè§†é¢‘æ’­æ”¾"
```

**LLMè‡ªåŠ¨ç”ŸæˆJSONæ™ºèƒ½ç”¨ä¾‹**ï¼š
```json
{
  "testcase_id": "TC_DOUYIN_SEARCH_20241205",
  "name": "æŠ–éŸ³ç¾é£Ÿè§†é¢‘æœç´¢æµ‹è¯•",
  "target_app": "com.mobile.brasiltvmobile",
  "execution_path": [
    {
      "step": 1,
      "action": "conditional_action",
      "condition": {
        "type": "element_content_check",
        "target": "search_input_box",
        "check": "has_text_content"
      },
      "conditional_paths": {
        "if_has_content": {
          "action": "click",
          "target": "clear_button",
          "reason": "æ¸…ç©ºå†å²æœç´¢è®°å½•"
        },
        "if_empty": {
          "action": "input",
          "data": "ç¾é£Ÿè§†é¢‘"
        }
      },
      "business_logic": "æ™ºèƒ½åˆ¤æ–­æœç´¢æ¡†çŠ¶æ€ï¼Œç¡®ä¿è¾“å…¥æ­£ç¡®",
      "ai_hint": "å¯»æ‰¾æœç´¢æ¡†å³ä¾§çš„Ã—æ¸…é™¤æŒ‰é’®"
    }
  ]
}
```

### æ­¥éª¤2ï¸âƒ£: è¯•è·‘é˜¶æ®µ - è®¾å¤‡ä¿¡æ¯æ¢æµ‹ä¸é€‚é…

**è‡ªåŠ¨è®¾å¤‡æ¢æµ‹**ï¼š
```python
device_info = {
    "device_name": "Pixel_6_Pro",
    "android_version": "13.0",
    "screen_resolution": "3120x1440",
    "screen_density": 560,
    "brand": "Google",
    "model": "Pixel 6 Pro"
}
```

**JSONç”¨ä¾‹è‡ªåŠ¨æ›´æ–°**ï¼š
```json
{
  "device_adaptation": {
    "detected_device": "Pixel_6_Pro",
    "screen_info": {
      "resolution": "3120x1440", 
      "density": 560,
      "orientation": "portrait"
    },
    "adaptation_rules": {
      "touch_offset": {"x": 0, "y": 0},
      "element_scaling": 1.0,
      "recognition_mode": "hybrid"
    }
  },
  "execution_environment": {
    "android_version": "13.0",
    "target_sdk": 33,
    "permissions_granted": ["CAMERA", "STORAGE"],
    "network_status": "connected"
  }
}
```

### æ­¥éª¤3ï¸âƒ£: æ™ºèƒ½æ‰§è¡Œé˜¶æ®µ - è§†è§‰è¯†åˆ«ä¸ä¿¡æ¯ä¿ç•™

**æ‰§è¡Œè¿‡ç¨‹ä¸­çš„æ™ºèƒ½å¤„ç†**ï¼š

#### 3.1 åŒæ¨¡å¼è¯†åˆ«
```python
# è‡ªåŠ¨é€‰æ‹©è¯†åˆ«æ¨¡å¼
if is_media_playing():
    recognition_mode = "visual"  # è§†é¢‘æ’­æ”¾æ—¶ç”¨è§†è§‰è¯†åˆ«
    use_omniparser = True
else:
    recognition_mode = "xml"     # é™æ€ç•Œé¢ç”¨XML
    use_dump_ui = True
```

#### 3.2 æˆªå›¾å’Œè¯†åˆ«ç»“æœä¿å­˜
```json
{
  "execution_results": {
    "step_1": {
      "timestamp": "2024-12-05T14:30:22Z",
      "screenshots": {
        "before_action": "assets/douyin_Pixel6Pro/step1_before_20241205_143022.png",
        "after_action": "assets/douyin_Pixel6Pro/step1_after_20241205_143025.png"
      },
      "recognition_data": {
        "mode": "visual",
        "elements_found": [
          {
            "type": "input_field",
            "text": "å†å²æœç´¢å†…å®¹", 
            "confidence": 0.95,
            "coordinates": {"x": 540, "y": 200, "width": 300, "height": 50},
            "screenshot": "assets/douyin_Pixel6Pro/step1_element_input_20241205_143022.png"
          }
        ],
        "omniparser_result": "assets/douyin_Pixel6Pro/step1_omni_result.json"
      }
    }
  }
}
```

#### 3.3 è·¯å¾„ç»„ç»‡è§„åˆ™
```
assets/
â”œâ”€â”€ {app_package}_{device_name}/     # æŒ‰åº”ç”¨å’Œè®¾å¤‡åˆ†ç±»
â”‚   â”œâ”€â”€ step1_before_20241205_143022.png        # æ­¥éª¤æ‰§è¡Œå‰æˆªå›¾
â”‚   â”œâ”€â”€ step1_after_20241205_143025.png         # æ­¥éª¤æ‰§è¡Œåæˆªå›¾  
â”‚   â”œâ”€â”€ step1_element_input_20241205_143022.png # è¯†åˆ«åˆ°çš„å…ƒç´ æˆªå›¾
â”‚   â”œâ”€â”€ step1_omni_result.json                  # Omniparserè¯†åˆ«ç»“æœ
â”‚   â””â”€â”€ execution_log.json                      # æ‰§è¡Œæ—¥å¿—
â””â”€â”€ douyin_Pixel6Pro/
    â””â”€â”€ (å…·ä½“æ–‡ä»¶...)
```

---

# 4. æ ¸å¿ƒç»„ä»¶è¯¦è§£

## 4.1 ConfigManager - é…ç½®ç®¡ç†æ ¸å¿ƒ

**èŒè´£**: ç»Ÿä¸€ç®¡ç†æ‰€æœ‰é…ç½®ä¿¡æ¯ï¼Œæä¾›ç±»å‹å®‰å…¨çš„é…ç½®è®¿é—®æ¥å£

**æ ¸å¿ƒåŠŸèƒ½**:
- ğŸ“‹ è®¾å¤‡é…ç½®ç®¡ç† (ç¡¬ä»¶ä¿¡æ¯ã€æ‰§è¡Œé…ç½®ã€è¯†åˆ«é…ç½®)
- ğŸ“± åº”ç”¨é…ç½®ç®¡ç† (åŒ…åã€å¯åŠ¨é…ç½®ã€ä¸šåŠ¡åœºæ™¯)
- ğŸ§ª æµ‹è¯•å¥—ä»¶ç®¡ç† (è®¾å¤‡ç»„åˆã€åº”ç”¨ç»„åˆã€æµ‹è¯•åœºæ™¯)
- ğŸ¤– LLMæœåŠ¡é…ç½® (APIå¯†é’¥ã€æ¨¡å‹é€‰æ‹©ã€å‚æ•°é…ç½®)
- ğŸ“‚ è·¯å¾„æ¨¡æ¿ç®¡ç† (èµ„æºè·¯å¾„ã€æŠ¥å‘Šè·¯å¾„ã€ä»£ç è·¯å¾„)
- ğŸ’¾ è®¾å¤‡ä¿¡æ¯ç¼“å­˜ (é¿å…é‡å¤æ¢æµ‹)

**é…ç½®ç»“æ„**:
```yaml
# main.yaml æ ¸å¿ƒé…ç½®
global_config:          # å…¨å±€é…ç½®
devices:                # è®¾å¤‡é…ç½®ç»„
  device_id:
    phone_type: "android_phone"
    screen_info: {...}   # å±å¹•ä¿¡æ¯
    execution_config: {...}  # æ‰§è¡Œé…ç½®
    recognition_config: {...}  # è¯†åˆ«é…ç½®
applications:           # åº”ç”¨é…ç½®ç»„  
  app_id:
    package_name: "..."
    app_config: {...}    # åº”ç”¨ç‰¹å®šé…ç½®
test_suites:           # æµ‹è¯•å¥—ä»¶é…ç½®
llm_config:            # LLMé…ç½®
path_templates:        # è·¯å¾„æ¨¡æ¿
```

## 4.2 LLMClient - æ™ºèƒ½æœåŠ¡é›†æˆ

**èŒè´£**: æä¾›ç»Ÿä¸€çš„LLMæœåŠ¡æ¥å£ï¼Œæ”¯æŒå¤šæä¾›å•†å’Œè‡ªåŠ¨å›é€€

**æ”¯æŒçš„LLMæä¾›å•†**:
- ğŸ”µ OpenAI Compatible API (é»˜è®¤æ¨è)
- ğŸŸ¢ OpenAI Official API  
- ğŸŸ£ Anthropic Claude API

**æ ¸å¿ƒåŠŸèƒ½**:
- ğŸ¤– æ™ºèƒ½æµ‹è¯•ç”¨ä¾‹ç”Ÿæˆ (è‡ªç„¶è¯­è¨€ â†’ JSONç»“æ„)
- ğŸ“ æµ‹è¯•ç”¨ä¾‹è´¨é‡å®¡æŸ¥ (é€»è¾‘å®Œæ•´æ€§ã€é€‰æ‹©å™¨å‡†ç¡®æ€§)
- ğŸ”„ è‡ªåŠ¨é‡è¯•å’Œé”™è¯¯å¤„ç†
- ğŸ¯ å›é€€æœºåˆ¶ (ä¸»æœåŠ¡ â†’ å¤‡ç”¨æœåŠ¡)
- ğŸ“Š ä½¿ç”¨ç»Ÿè®¡å’Œç›‘æ§

**LLMé…ç½®ç¤ºä¾‹**:
```bash
# .env é…ç½®
LLM_PROVIDER=openai_compatible
LLM_API_URL=https://api.llmproai.xyz/v1/chat/completions
LLM_API_KEY=sk-xxx
LLM_MODEL=gpt-oss-120b

# å¤‡ç”¨é…ç½®
LLM_FALLBACK_PROVIDER=openai
LLM_FALLBACK_API_KEY=sk-xxx
LLM_FALLBACK_MODEL=gpt-3.5-turbo
```

## 4.3 SmartExecutor - æ™ºèƒ½æ‰§è¡Œå¼•æ“

**èŒè´£**: æ‰§è¡ŒJSONæµ‹è¯•ç”¨ä¾‹ï¼Œå¤„ç†æ¡ä»¶åˆ†æ”¯é€»è¾‘å’ŒåŒæ¨¡è¯†åˆ«

**æ ¸å¿ƒç‰¹æ€§**:
- ğŸ§  **æ¡ä»¶åˆ†æ”¯å¤„ç†**: 
  - "å¦‚æœæœç´¢æ¡†æœ‰å†…å®¹å…ˆæ¸…ç©º" â†’ è‡ªåŠ¨åˆ¤æ–­å¹¶é€‰æ‹©æ‰§è¡Œè·¯å¾„
  - æ”¯æŒå¤šå±‚åµŒå¥—æ¡ä»¶é€»è¾‘
- ğŸ” **åŒæ¨¡è¯†åˆ«ç³»ç»Ÿ**:
  - é™æ€ç•Œé¢: XML/UIAutomator2 (å¿«é€Ÿã€å‡†ç¡®)
  - åŠ¨æ€å†…å®¹: Omniparserè§†è§‰è¯†åˆ« (åª’ä½“æ’­æ”¾æ—¶)
- ğŸ“¸ **æ™ºèƒ½æˆªå›¾ç®¡ç†**: æ‰§è¡Œå‰åè‡ªåŠ¨æˆªå›¾
- ğŸ“ **å®Œæ•´æ‰§è¡Œè®°å½•**: æ¯æ­¥æ“ä½œéƒ½æœ‰è¯¦ç»†æ—¥å¿—
- âš¡ **æ€§èƒ½ä¼˜åŒ–**: è¯†åˆ«æ¨¡å¼æ™ºèƒ½åˆ‡æ¢ï¼Œå‡å°‘ä¸å¿…è¦å¼€é”€

---

# 5. å®‰è£…é…ç½®æŒ‡å—

## 5.1 ç³»ç»Ÿè¦æ±‚

### è½¯ä»¶è¦æ±‚
- **Python**: 3.8 æˆ–æ›´é«˜ç‰ˆæœ¬ (æ¨è 3.9+)
- **æ“ä½œç³»ç»Ÿ**: Windows 10/11, macOS 10.15+, Ubuntu 18.04+
- **Androidè®¾å¤‡**: Android 5.0 (API 21) æˆ–æ›´é«˜ç‰ˆæœ¬
- **Java**: JDK 8 æˆ–æ›´é«˜ç‰ˆæœ¬

### ç¡¬ä»¶è¦æ±‚
- **å†…å­˜**: æœ€å° 4GB RAM (æ¨è 8GB+)
- **å­˜å‚¨**: æœ€å° 2GB å¯ç”¨ç©ºé—´
- **ç½‘ç»œ**: ç¨³å®šçš„ç½‘ç»œè¿æ¥ (ç”¨äºLLM APIè°ƒç”¨)

## 5.2 å¿«é€Ÿå®‰è£…

### 1. å…‹éš†é¡¹ç›®
```bash
git clone <repository-url>
cd airtest
```

### 2. åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ (æ¨è)
```bash
# ä½¿ç”¨ venv
python -m venv only_test_env
source only_test_env/bin/activate  # Linux/macOS
# æˆ–
only_test_env\Scripts\activate     # Windows

# ä½¿ç”¨ conda
conda create -n only_test python=3.9
conda activate only_test
```

### 3. å®‰è£…ä¾èµ–
```bash
pip install -r requirements.txt
```

### 4. é…ç½®ç¯å¢ƒå˜é‡
```bash
# å¤åˆ¶ç¯å¢ƒé…ç½®æ–‡ä»¶
cp .env.example .env

# ç¼–è¾‘é…ç½®æ–‡ä»¶ï¼Œå¡«å…¥ä½ çš„APIå¯†é’¥
nano .env  # æˆ–ä½¿ç”¨å…¶ä»–ç¼–è¾‘å™¨
```

### 5. éªŒè¯å®‰è£…
```bash
python tools/integration_check.py
```

## 5.3 è¯¦ç»†é…ç½®

### ç¯å¢ƒå˜é‡é…ç½® (.env)

```bash
# === LLMæœåŠ¡é…ç½® ===
LLM_PROVIDER=openai_compatible
LLM_API_URL=https://your-api-endpoint.com/v1/chat/completions
LLM_API_KEY=sk-your-api-key-here
LLM_MODEL=gpt-4
LLM_TEMPERATURE=0.7

# === å¤‡ç”¨LLMé…ç½® ===
LLM_FALLBACK_PROVIDER=openai
LLM_FALLBACK_API_KEY=sk-your-fallback-key
LLM_FALLBACK_MODEL=gpt-3.5-turbo

# === å¼€å‘ç¯å¢ƒé…ç½® ===
ENVIRONMENT=development
DEBUG=true
LOG_LEVEL=DEBUG
```

### ä¸»é…ç½®æ–‡ä»¶ (testcases/main.yaml)

å‚è€ƒç°æœ‰çš„ `main.yaml` æ–‡ä»¶ï¼Œæ ¹æ®ä½ çš„è®¾å¤‡å’Œåº”ç”¨è¿›è¡Œé…ç½®ï¼š

```yaml
devices:
  your_device_id:
    phone_type: "android_phone"
    custom_name: "Your Device Name"
    android_version: "13"
    screen_info:
      resolution: "1080x1920"
      density: 420

applications:
  your_app:
    package_name: "com.your.app"
    app_name: "Your App"
    category: "your_category"
```

---

# 6. ä½¿ç”¨æŒ‡å—

## 6.1 å¿«é€Ÿå¼€å§‹

### 1. ç¯å¢ƒå‡†å¤‡

```bash
# ç¡®ä¿ä½ åœ¨ airtest ç›®å½•ä¸‹
cd /path/to/uni/airtest

# æ£€æŸ¥ç›®å½•ç»“æ„
ls -la
# åº”è¯¥çœ‹åˆ°: lib/, testcases/, tools/, config/, reports/ ç­‰ç›®å½•
```

### 2. ç¬¬ä¸€æ¬¡è¿è¡Œæ¼”ç¤º

```bash
# è¿è¡Œå†…ç½®æ¼”ç¤ºç”¨ä¾‹
python tools/test_runner.py --demo

# æŸ¥çœ‹ç”Ÿæˆçš„æ¼”ç¤ºç”¨ä¾‹
cat testcases/generated/demo_smart_search.json
```

### 3. ç”Ÿæˆä½ çš„ç¬¬ä¸€ä¸ªæµ‹è¯•ç”¨ä¾‹

```bash
# åŸºäºè‡ªç„¶è¯­è¨€ç”Ÿæˆç”¨ä¾‹
python tools/case_generator.py \
  --description "åœ¨çˆ±å¥‡è‰ºAPPä¸­æœç´¢ç”µå½±å¤ä»‡è€…è”ç›Ÿï¼Œç‚¹å‡»ç¬¬ä¸€ä¸ªç»“æœæ’­æ”¾" \
  --app "com.qiyi.video" \
  --device "android_phone"

# æŸ¥çœ‹ç”Ÿæˆçš„ç”¨ä¾‹
ls testcases/generated/
```

### 4. è¿è¡Œç”Ÿæˆçš„æµ‹è¯•ç”¨ä¾‹

```bash
# è¿è¡Œå•ä¸ªæµ‹è¯•ç”¨ä¾‹
python tools/test_runner.py --file testcases/generated/tc_com_qiyi_video_*.json

# æŸ¥çœ‹HTMLæŠ¥å‘Š
open reports/test_report_*.html
```

## 6.2 æ™ºèƒ½å…ƒæ•°æ®è¯¦è§£

### æ ¸å¿ƒè®¾è®¡ç†å¿µ

ä¼ ç»Ÿæµ‹è¯•ç”¨ä¾‹åªæè¿°"åšä»€ä¹ˆ"ï¼ŒOnly-Test çš„æ™ºèƒ½å…ƒæ•°æ®æè¿°"ä¸ºä»€ä¹ˆè¿™æ ·åš"å’Œ"å¦‚ä½•æ™ºèƒ½åˆ¤æ–­"ã€‚

```yaml
ä¼ ç»Ÿæ–¹å¼:
  - ç‚¹å‡»æœç´¢æŒ‰é’®
  - è¾“å…¥æœç´¢è¯
  - ç‚¹å‡»ç¡®è®¤

Only-Test æ–¹å¼:
  - ğŸ§  æ£€æŸ¥æœç´¢æ¡†çŠ¶æ€
  - ğŸ“‹ å¦‚æœæœ‰å†…å®¹ â†’ å…ˆæ¸…ç©ºå†è¾“å…¥
  - ğŸ“‹ å¦‚æœæ— å†…å®¹ â†’ ç›´æ¥è¾“å…¥
  - âœ… æ™ºèƒ½ç¡®è®¤æœç´¢æ‰§è¡Œ
```

### å…³é”®å…ƒæ•°æ®å­—æ®µ

#### 1. æ¡ä»¶åˆ†æ”¯é€»è¾‘
```json
{
  "action": "conditional_action",
  "condition": {
    "type": "element_content_check",
    "target": "search_input_box",
    "check": "has_text_content"
  },
  "conditional_paths": {
    "if_has_content": { "action": "click", "target": "clear_button" },
    "if_empty": { "action": "input", "data": "æœç´¢è¯" }
  }
}
```

#### 2. AIå‹å¥½æè¿°
```json
{
  "description": "æ ¹æ®æœç´¢æ¡†çŠ¶æ€æ™ºèƒ½é€‰æ‹©æ“ä½œ",
  "ai_hint": "å¯»æ‰¾è¾“å…¥æ¡†å³ä¾§çš„æ¸…é™¤æŒ‰é’®ï¼Œé€šå¸¸æ˜¯Ã—ç¬¦å·",
  "business_logic": "ç¡®ä¿æœç´¢æ¡†å¤„äºæ­£ç¡®çŠ¶æ€",
  "reason": "æœç´¢æ¡†å·²æœ‰å†…å®¹ï¼Œéœ€è¦å…ˆæ¸…ç©º"
}
```

---

# 7. æ‰§è¡Œä¸ç›‘æ§

## 7.1 å•ä¸ªç”¨ä¾‹æ‰§è¡Œ

```bash
# è¿è¡ŒæŒ‡å®šç”¨ä¾‹
python tools/test_runner.py --file testcases/generated/my_test.json

# æŒ‡å®šè®¾å¤‡
python tools/test_runner.py --file testcases/generated/my_test.json --device "emulator-5554"

# åªç”ŸæˆJSONæŠ¥å‘Š
python tools/test_runner.py --file testcases/generated/my_test.json --report json
```

## 7.2 æ‰¹é‡æ‰§è¡Œ

```bash
# è¿è¡Œç›®å½•ä¸­æ‰€æœ‰ç”¨ä¾‹
python tools/test_runner.py --dir testcases/generated/

# è¿è¡Œæ‰‹åŠ¨ç¼–å†™çš„ç”¨ä¾‹
python tools/test_runner.py --dir testcases/manual/

# ç”ŸæˆHTMLå’ŒJSONæŠ¥å‘Š
python tools/test_runner.py --dir testcases/generated/ --report both
```

## 7.3 æ‰§è¡Œè¿‡ç¨‹ç›‘æ§

æ‰§è¡Œæ—¶ä½ ä¼šçœ‹åˆ°è¯¦ç»†çš„æ™ºèƒ½å†³ç­–è¿‡ç¨‹ï¼š

```
ğŸ“‹ æµ‹è¯•ç”¨ä¾‹ä¿¡æ¯
============================================================
ğŸ“ åç§°: æ™ºèƒ½æœç´¢åŠŸèƒ½æµ‹è¯•
ğŸ§  æ™ºèƒ½æ¡ä»¶æ­¥éª¤: 2ä¸ª
   1. æ ¹æ®æœç´¢æ¡†çŠ¶æ€æ™ºèƒ½é€‰æ‹©æ“ä½œ
      â””â”€ æ¡ä»¶: element_content_check - has_text_content
   2. ç¡®ä¿æœç´¢è¯æ­£ç¡®è¾“å…¥

ğŸš€ å¼€å§‹æ‰§è¡Œæµ‹è¯•ç”¨ä¾‹: æ™ºèƒ½æœç´¢åŠŸèƒ½æµ‹è¯•
â–¶ï¸  Step 1: ç‚¹å‡»é¦–é¡µæœç´¢æŒ‰é’®
â–¶ï¸  Step 2: æ ¹æ®æœç´¢æ¡†çŠ¶æ€æ™ºèƒ½é€‰æ‹©æ“ä½œ
ğŸ§  æ‰§è¡Œæ¡ä»¶åˆ†æ”¯é€»è¾‘
ğŸ¯ æ¡ä»¶è¯„ä¼°ç»“æœ: True
ğŸ“ é€‰æ‹©è·¯å¾„: click -> clear_button
ğŸ’¡ é€‰æ‹©åŸå› : æœç´¢æ¡†å·²æœ‰å†…å®¹ï¼Œéœ€è¦å…ˆæ¸…ç©º

âœ… æµ‹è¯•ç”¨ä¾‹æ‰§è¡Œå®Œæˆ: æ™ºèƒ½æœç´¢åŠŸèƒ½æµ‹è¯•
ğŸ“Š æ•´ä½“çŠ¶æ€: success
â±ï¸  æ€»è€—æ—¶: 15.32 ç§’
ğŸ”„ æ¢å¤æ¬¡æ•°: 0
```

---

# 8. Phone-Use MCP é›†æˆ

## 8.1 è®¾è®¡ç†å¿µ

Phone MCP Plugin æ˜¯ä¸€ä¸ªå¼ºå¤§çš„ MCP æ’ä»¶ï¼Œè¯æ˜äº† LLM + MCP å¯ä»¥æˆåŠŸæ§åˆ¶ Android APK æ“ä½œï¼Œå…·æœ‰ç¡®å®šæ€§çš„è‡ªåŠ¨åŒ–ï¼Œæœ€ç»ˆå®ç° APK è‡ªåŠ¨åŒ–æµ‹è¯•çš„è‡ªåŠ¨æµ‹è¯•ç”¨ä¾‹ç”Ÿæˆã€‚

## 8.2 æ™ºèƒ½åŒæ¨¡è¯†åˆ«ç³»ç»Ÿ

### æ ¸å¿ƒåˆ›æ–°: è‡ªé€‚åº”UIè¯†åˆ«
ç³»ç»Ÿæ ¹æ®å®æ—¶åº”ç”¨çŠ¶æ€æ™ºèƒ½åˆ‡æ¢ä¸¤ç§è¯†åˆ«æ¨¡å¼:

#### ğŸ”„ **æ¨¡å¼1: dump_ui (uiautomator2) - å¿«é€Ÿç²¾å‡†**
- **ä½¿ç”¨åœºæ™¯**: æ™®é€šåº”ç”¨çŠ¶æ€ã€æš‚åœè§†é¢‘æ’­æ”¾ã€é™æ€UIå…ƒç´ 
- **ä¼˜åŠ¿**: é—ªç”µèˆ¬å¿«é€Ÿå“åº”ã€å¯è®¿é—®å…ƒç´ 100%å‡†ç¡®ç‡
- **æŠ€æœ¯**: åŸç”ŸAndroid uiautomator2 XMLå±‚çº§è§£æ

#### ğŸ” **æ¨¡å¼2: omniparser (AIè§†è§‰è¯†åˆ«) - å…¨é¢è¦†ç›–**
- **ä½¿ç”¨åœºæ™¯**: è§†é¢‘æ’­æ”¾ã€åŠ¨æ€å†…å®¹ã€ä¸å¯è®¿é—®UIå…ƒç´   
- **ä¼˜åŠ¿**: é€‚ç”¨ä»»ä½•è§†è§‰å†…å®¹ï¼Œå¤„ç†å¤æ‚åª’ä½“ç•Œé¢
- **æŠ€æœ¯**: YOLO + PaddleOCRè®¡ç®—æœºè§†è§‰ï¼Œ~90%å‡†ç¡®ç‡ï¼ŒGPUå¯†é›†
- **æƒè¡¡**: å¤„ç†è¾ƒæ…¢ï¼Œéœ€è¦GPUèµ„æºï¼Œé”™è¯¯ç‡æ›´é«˜

### ğŸ¤– è‡ªåŠ¨æ¨¡å¼é€‰æ‹©é€»è¾‘
ç³»ç»Ÿä½¿ç”¨å¤šå±‚çŠ¶æ€åˆ†æ**è‡ªåŠ¨æ£€æµ‹**æœ€ä½³è¯†åˆ«æ¨¡å¼:

#### ğŸ¯ **æ™ºèƒ½çŠ¶æ€æ£€æµ‹æµæ°´çº¿**
```
XMLçŠ¶æ€æ£€æµ‹ â†’ åª’ä½“æ’­æ”¾æ£€æµ‹ â†’ å…ƒç´ å¯è®¿é—®æ€§åˆ†æ â†’ æ¨¡å¼æ™ºèƒ½é€‰æ‹©
    â†“              â†“                â†“                   â†“
   å¿«é€Ÿ            è§†è§‰              æ··åˆ               æœ€ä¼˜ç­–ç•¥
```

## 8.3 æ ¸å¿ƒç»„ä»¶

**ä¸»å…¥å£ç‚¹:**
- `phone_mcp/__main__.py` - MCPæœåŠ¡å™¨å…¥å£ï¼Œå…¨é¢å·¥å…·æ³¨å†Œ
- `phone_mcp/cli.py` - å‘½ä»¤è¡Œç•Œé¢
- `phone_mcp/core.py` - æ ¸å¿ƒADBå‘½ä»¤æ‰§è¡Œå’Œè®¾å¤‡è¿æ¥é€»è¾‘

**é«˜çº§è§†è§‰è¯†åˆ«å·¥å…· (phone_mcp/tools/):**
- `omniparser_interface.py` - **æ ¸å¿ƒOmniparseré›†æˆ**ï¼Œè§†è§‰å…ƒç´ è¯†åˆ«
- `omniparser_tools.py` - **MCPå…¼å®¹Omniparserå‡½æ•°**ï¼Œç²¾ç¡®UIäº¤äº’
- `prompt_engineering.py` - **AIä»»åŠ¡æŒ‡å¯¼ç³»ç»Ÿ**ï¼Œåå·®æ£€æµ‹å’Œå®šä½å¸®åŠ©
- `android_computer_integration.py` - å¢å¼ºçš„Androidè‡ªåŠ¨åŒ–ï¼Œåæ ‡å›é€€

**ä¼ ç»Ÿå·¥å…·æ¨¡å—:**
- `adb_tools.py` - æ–‡ä»¶æ“ä½œã€APKå®‰è£…ã€ç³»ç»Ÿæ§åˆ¶
- `apps.py` - åº”ç”¨å¯åŠ¨å’Œç®¡ç†  
- `media.py` - æˆªå›¾ã€å±å¹•å½•åˆ¶
- `screen_interface.py` - åŸºç¡€å±å¹•äº¤äº’å’Œåˆ†æ
- `ui_monitor.py` - UIå˜åŒ–ç›‘æ§å’Œè‡ªåŠ¨åŒ–
- `system.py` - ç³»ç»Ÿä¿¡æ¯å’Œè®¾å¤‡ç®¡ç†
- `maps.py` - åŸºäºä½ç½®çš„æœåŠ¡å’ŒPOIæœç´¢
- `interactions.py` - ç»Ÿä¸€äº¤äº’æ¥å£

## 8.4 å…³é”®ç‰¹æ€§ä¸èƒ½åŠ›

#### è§†è§‰è¯†åˆ«ä¸ç²¾ç¡®äº¤äº’
- **Omniparseré›†æˆ**: ä½¿ç”¨è®¡ç®—æœºè§†è§‰(YOLO + PaddleOCR)è¿›è¡Œè§†è§‰UIå…ƒç´ è¯†åˆ«
- **åŸºäºUUIDçš„å…ƒç´ å®šä½**: æ¯ä¸ªUIå…ƒç´ è·å¾—å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œå®ç°ç²¾ç¡®äº¤äº’
- **åå·®çŸ«æ­£**: åª’ä½“å†…å®¹ä¸­æ ‡é¢˜å‡ºç°åœ¨å¯ç‚¹å‡»åŒºåŸŸä¸‹æ–¹æ—¶çš„è‡ªåŠ¨çŸ«æ­£
- **å›é€€ç³»ç»Ÿ**: è§†è§‰è¯†åˆ«å¤±è´¥æ—¶åŸºäºåæ ‡çš„äº¤äº’

#### AIå¢å¼ºè‡ªåŠ¨åŒ–
- **ä»»åŠ¡æŒ‡å¯¼ç³»ç»Ÿ**: ä¸åŒè‡ªåŠ¨åŒ–åœºæ™¯çš„æ™ºèƒ½æç¤º
- **åå·®æ£€æµ‹**: è‡ªåŠ¨æ£€æµ‹ä½•æ—¶éœ€è¦åå·®çŸ«æ­£
- **å®šä½æŒ‡å¯¼**: å…ƒç´ äº¤äº’ç­–ç•¥çš„æ™ºèƒ½å»ºè®®
- **ä¸Šä¸‹æ–‡æ„ŸçŸ¥äº¤äº’**: æ ¹æ®å†…å®¹ç±»å‹è°ƒæ•´äº¤äº’æ–¹å¼

#### å·¥å…·æ¶æ„
- **30+ä¸ªMCPå·¥å…·**: ç”µè¯æ§åˆ¶åŠŸèƒ½çš„å…¨é¢è¦†ç›–
- **åˆ†å±‚åŠŸèƒ½**: ä¸“ä¸šè§†è§‰å·¥å…· + åŸºç¡€ADBæ“ä½œ + è¾…åŠ©åŠŸèƒ½
- **æœåŠ¡å™¨é›†æˆ**: OmniparseræœåŠ¡å™¨é€šä¿¡(é»˜è®¤: http://100.122.57.128:9333)

---

# 9. åä½œæ¶æ„è®¾è®¡

## 9.1 å¤šç»„ä»¶åä½œæœºåˆ¶

Only-Test æ¡†æ¶é€šè¿‡ç²¾å¿ƒè®¾è®¡çš„æ¥å£å’Œåè®®å®ç°å„ç»„ä»¶é—´çš„æ— ç¼åä½œï¼š

### ğŸ”— ç»„ä»¶é—´é€šä¿¡åè®®
- **JSONæ¶ˆæ¯æ ¼å¼**: ç»Ÿä¸€çš„æ•°æ®äº¤æ¢æ ¼å¼
- **äº‹ä»¶é©±åŠ¨æ¶æ„**: åŸºäºäº‹ä»¶çš„å¼‚æ­¥é€šä¿¡
- **é”™è¯¯ä¼ æ’­æœºåˆ¶**: å®Œæ•´çš„é”™è¯¯å¤„ç†å’Œæ¢å¤é“¾
- **çŠ¶æ€åŒæ­¥**: å®æ—¶çš„ç»„ä»¶çŠ¶æ€åŒæ­¥

### ğŸ“Š æ•°æ®æµè®¾è®¡
```
ç”¨æˆ·è¾“å…¥ â†’ é…ç½®ç®¡ç†å™¨ â†’ LLMå®¢æˆ·ç«¯ â†’ æµ‹è¯•ç”Ÿæˆå™¨
                                    â†“
è®¾å¤‡é€‚é…å™¨ â† èµ„æºç®¡ç†å™¨ â† æ‰§è¡Œå¼•æ“ â† JSONç”¨ä¾‹
    â†“              â†“         â†“
 è®¾å¤‡ä¿¡æ¯     â†’ æ‰§è¡Œè®°å½•  â†’ æ‰§è¡Œç»“æœ
    â†“              â†“         â†“
ä»£ç ç”Ÿæˆå™¨ â† æŠ¥å‘Šç”Ÿæˆå™¨ â† ç»“æœåˆ†æå™¨
```

### ğŸ¤ æ¥å£æ ‡å‡†åŒ–
- **ç»Ÿä¸€çš„é…ç½®æ¥å£**: æ‰€æœ‰ç»„ä»¶å…±äº«é…ç½®è®¿é—®æ ‡å‡†
- **æ ‡å‡†åŒ–çš„æ‰§è¡Œæ¥å£**: ä¸€è‡´çš„æµ‹è¯•æ‰§è¡Œåè®®
- **è§„èŒƒåŒ–çš„ç»“æœæ ¼å¼**: ç»Ÿä¸€çš„ç»“æœæ•°æ®ç»“æ„
- **å¯æ‰©å±•çš„æ’ä»¶æ¥å£**: æ”¯æŒç¬¬ä¸‰æ–¹ç»„ä»¶é›†æˆ

## 9.2 æ™ºèƒ½ååŒç‰¹æ€§

### ğŸ§  æ™ºèƒ½å†³ç­–åä½œ
- **å¤šå±‚æ™ºèƒ½åˆ¤æ–­**: LLMã€è§„åˆ™å¼•æ“ã€æ¡ä»¶é€»è¾‘çš„ååŒå†³ç­–
- **ä¸Šä¸‹æ–‡æ„ŸçŸ¥**: å„ç»„ä»¶å…±äº«åº”ç”¨çŠ¶æ€å’Œè®¾å¤‡ä¿¡æ¯
- **è‡ªé€‚åº”ä¼˜åŒ–**: åŸºäºæ‰§è¡Œå†å²çš„åŠ¨æ€ç­–ç•¥è°ƒæ•´
- **å¼‚å¸¸ååŒå¤„ç†**: å¤šç»„ä»¶è”åˆçš„å¼‚å¸¸æ¢å¤æœºåˆ¶

### ğŸ”„ å®æ—¶åé¦ˆå¾ªç¯
- **æ‰§è¡ŒçŠ¶æ€å®æ—¶åŒæ­¥**: å„ç»„ä»¶çš„æ‰§è¡ŒçŠ¶æ€å®æ—¶å…±äº«
- **æ€§èƒ½æŒ‡æ ‡æ”¶é›†**: å…¨é“¾è·¯æ€§èƒ½æ•°æ®ç»Ÿè®¡
- **è´¨é‡åé¦ˆæœºåˆ¶**: æ‰§è¡Œè´¨é‡çš„å®æ—¶è¯„ä¼°å’Œæ”¹è¿›
- **å­¦ä¹ æ•°æ®ç§¯ç´¯**: æ‰§è¡Œç»éªŒçš„æŒç»­å­¦ä¹ å’Œåº”ç”¨

---

# 10. å¸¸è§é—®é¢˜è§£å†³

## 10.1 å®‰è£…ç›¸å…³é—®é¢˜

### é—®é¢˜1: æ‰¾ä¸åˆ°Pythonæ¨¡å—
```bash
# é”™è¯¯: ModuleNotFoundError: No module named 'yaml'
pip install pyyaml>=6.0

# é”™è¯¯: No module named 'openai'
pip install openai>=1.0.0
```

### é—®é¢˜2: ADBè®¾å¤‡è¿æ¥å¤±è´¥
```bash
# æ£€æŸ¥ADBç‰ˆæœ¬
adb version

# é‡å¯ADBæœåŠ¡
adb kill-server && adb start-server

# æ£€æŸ¥è®¾å¤‡æƒé™
adb shell pm list permissions | grep android.permission
```

### é—®é¢˜3: UIAutomator2è¿æ¥å¤±è´¥
```bash
# é‡æ–°å®‰è£…UIAutomator2æœåŠ¡
python -m uiautomator2 init

# æ£€æŸ¥æœåŠ¡çŠ¶æ€
adb shell am instrument -e debug false -w com.github.uiautomator.test/androidx.test.runner.AndroidJUnitRunner
```

### é—®é¢˜4: LLM APIè°ƒç”¨å¤±è´¥
```bash
# æ£€æŸ¥ç½‘ç»œè¿æ¥
curl -I https://api.openai.com

# éªŒè¯APIå¯†é’¥
python -c "
from openai import OpenAI
client = OpenAI(api_key='your-key')
print('API Key æœ‰æ•ˆ:', bool(client))
"
```

### é—®é¢˜5: æƒé™é—®é¢˜
```bash
# Linux/macOS æƒé™ä¿®å¤
chmod +x tools/*.py
chmod +x lib/*.py

# Windows æƒé™é—®é¢˜
# ä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œç»ˆç«¯
```

## 10.2 ä½¿ç”¨ç›¸å…³é—®é¢˜

### Q: ä»€ä¹ˆæ—¶å€™ä½¿ç”¨æ¡ä»¶åˆ†æ”¯é€»è¾‘ï¼Ÿ

**A:** å½“æµ‹è¯•æ­¥éª¤éœ€è¦æ ¹æ®ç•Œé¢çŠ¶æ€åŠ¨æ€é€‰æ‹©æ“ä½œæ—¶ï¼š

- æœç´¢æ¡†å¯èƒ½æœ‰å†å²å†…å®¹éœ€è¦æ¸…ç©º
- ç™»å½•çŠ¶æ€ä¸ç¡®å®šéœ€è¦åˆ¤æ–­
- å¼¹çª—å‡ºç°ä¸å¦éœ€è¦å¤„ç†
- ä¸åŒè®¾å¤‡çš„ç•Œé¢å¸ƒå±€å·®å¼‚

### Q: å¦‚ä½•æé«˜å…ƒç´ è¯†åˆ«çš„å‡†ç¡®æ€§ï¼Ÿ

**A:** ä½¿ç”¨å¤šé‡é€‰æ‹©å™¨ç­–ç•¥ï¼š

```json
{
  "target": {
    "priority_selectors": [
      {"resource_id": "precise_id"},           // æœ€å‡†ç¡®
      {"content_desc": "æè¿°æ–‡å­—"},            // æ¬¡é€‰
      {"text": "æ˜¾ç¤ºæ–‡å­—"},                    // å¤‡é€‰
      {"xpath": "//xpath/expression"},        // é™çº§
      {"visual_hint": "è§†è§‰è¯†åˆ«æè¿°"}          // å…œåº•
    ]
  }
}
```

### Q: æ‰§è¡Œå¤±è´¥æ—¶å¦‚ä½•è°ƒè¯•ï¼Ÿ

**A:** æ£€æŸ¥ä»¥ä¸‹å‡ ç‚¹ï¼š

1. **æŸ¥çœ‹æˆªå›¾**: `reports/debug_step_*.png`
2. **æ£€æŸ¥æ—¥å¿—**: æ‰§è¡Œæ—¶çš„è¯¦ç»†æ—¥å¿—è¾“å‡º
3. **éªŒè¯é€‰æ‹©å™¨**: ç¡®è®¤å…ƒç´ é€‰æ‹©å™¨æ˜¯å¦æ­£ç¡®
4. **æµ‹è¯•æ¡ä»¶é€»è¾‘**: æ£€æŸ¥æ¡ä»¶åˆ¤æ–­æ˜¯å¦ç¬¦åˆé¢„æœŸ

### Q: å¦‚ä½•é›†æˆåˆ° CI/CDï¼Ÿ

**A:** åˆ›å»ºè‡ªåŠ¨åŒ–è„šæœ¬ï¼š

```bash
#!/bin/bash
# run_tests.sh

# ç”Ÿæˆæµ‹è¯•ç”¨ä¾‹
python tools/case_generator.py --dir testcases/templates/ --output testcases/generated/

# æ‰§è¡Œæ‰€æœ‰ç”¨ä¾‹
python tools/test_runner.py --dir testcases/generated/ --report json

# æ£€æŸ¥ç»“æœ
if [ $? -eq 0 ]; then
  echo "âœ… All tests passed"
  exit 0
else
  echo "âŒ Some tests failed"
  exit 1
fi
```

---

# 11. å®è·µæ¡ˆä¾‹

## 11.1 æ¡ˆä¾‹1ï¼šéŸ³ä¹APPæ™ºèƒ½æœç´¢

```bash
# ç”Ÿæˆç”¨ä¾‹
python tools/case_generator.py \
  --description "åœ¨ç½‘æ˜“äº‘éŸ³ä¹ä¸­æœç´¢'å‘Šç™½æ°”çƒ'ï¼Œå¦‚æœæœç´¢å†å²æœ‰å†…å®¹å…ˆæ¸…ç©º" \
  --app "com.netease.cloudmusic"

# æ‰§è¡Œç”¨ä¾‹
python tools/test_runner.py --file testcases/generated/tc_com_netease_cloudmusic_*.json
```

**æ™ºèƒ½ç‰¹æ€§å±•ç¤º**ï¼š
- è‡ªåŠ¨æ£€æµ‹æœç´¢æ¡†çŠ¶æ€
- æ™ºèƒ½é€‰æ‹©æ¸…ç©ºæˆ–ç›´æ¥è¾“å…¥
- éªŒè¯æœç´¢ç»“æœç›¸å…³æ€§

## 11.2 æ¡ˆä¾‹2ï¼šè§†é¢‘APPæ¡ä»¶å¯¼èˆª

```bash
# ç”Ÿæˆå¤æ‚å¯¼èˆªç”¨ä¾‹
python tools/case_generator.py \
  --description "æ‰“å¼€çˆ±å¥‡è‰ºï¼Œå¦‚æœæœ‰ç™»å½•å¼¹çª—å°±å…³é—­ï¼Œæœç´¢'æµæµªåœ°çƒ'å¹¶æ’­æ”¾ç¬¬ä¸€ä¸ªç»“æœ" \
  --app "com.qiyi.video"
```

**æ™ºèƒ½ç‰¹æ€§å±•ç¤º**ï¼š
- å¼¹çª—æ£€æµ‹å’Œå¤„ç†
- å¤šå±‚æ¡ä»¶åˆ¤æ–­
- æ™ºèƒ½å¼‚å¸¸æ¢å¤

## 11.3 æ¡ˆä¾‹3ï¼šç”µå•†APPè´­ç‰©æµç¨‹

åˆ›å»º `testcases/manual/smart_shopping.json`ï¼š

```json
{
  "name": "æ™ºèƒ½è´­ç‰©æµç¨‹æµ‹è¯•",
  "execution_path": [
    {
      "step": 1,
      "action": "conditional_action",
      "condition": {
        "type": "element_exists",
        "target": {"text": "ç™»å½•"}
      },
      "conditional_paths": {
        "if_true": {
          "action": "click",
          "target": {"text": "ç™»å½•"},
          "reason": "ç”¨æˆ·æœªç™»å½•ï¼Œéœ€è¦å…ˆç™»å½•"
        },
        "if_false": {
          "action": "click", 
          "target": {"resource_id": "search_box"},
          "reason": "ç”¨æˆ·å·²ç™»å½•ï¼Œç›´æ¥æœç´¢å•†å“"
        }
      }
    }
  ]
}
```

## 11.4 æ¡ˆä¾‹4ï¼šè·¨è®¾å¤‡é€‚é…æµ‹è¯•

```bash
# æ‰‹æœºç‰ˆæœ¬
python tools/case_generator.py \
  --template "smart_search_template" \
  --app "com.example.app" \
  --device "android_phone"

# TVç‰ˆæœ¬  
python tools/case_generator.py \
  --template "smart_search_template" \
  --app "com.example.app.tv" \
  --device "android_tv"
```

---

# 12. é«˜çº§é…ç½®

## 12.1 å¤šè®¾å¤‡å¹¶è¡Œæµ‹è¯•
```yaml
# main.yaml ä¸­é…ç½®å¤šä¸ªè®¾å¤‡
devices:
  device1:
    custom_name: "Pixel 6 Pro"
    connection:
      adb_serial: "123456789"
  device2:
    custom_name: "Samsung Galaxy"
    connection:
      adb_serial: "987654321"
```

## 12.2 è‡ªå®šä¹‰LLMæä¾›å•†
```python
# æ‰©å±• LLMClient æ”¯æŒè‡ªå®šä¹‰API
from lib.llm_integration.llm_client import BaseLLMProvider

class CustomLLMProvider(BaseLLMProvider):
    def chat_completion(self, messages, **kwargs):
        # å®ç°ä½ çš„è‡ªå®šä¹‰LLMæ¥å£
        pass
```

## 12.3 æŒç»­é›†æˆé…ç½®
```yaml
# .github/workflows/test.yml
name: Only-Test CI
on: [push, pull_request]
jobs:
  test:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3
    - uses: actions/setup-python@v4
      with:
        python-version: '3.9'
    - run: pip install -r requirements.txt
    - run: python tools/integration_check.py
```

---

# 13. æ€§èƒ½ä¼˜åŒ–

## 13.1 é…ç½®ç¼“å­˜
- è®¾å¤‡ä¿¡æ¯ç¼“å­˜ (24å°æ—¶æœ‰æ•ˆæœŸ)
- é…ç½®æ–‡ä»¶å˜æ›´æ£€æµ‹
- å†…å­˜é…ç½®ç¼“å­˜

## 13.2 æ‰§è¡Œä¼˜åŒ–
- è¯†åˆ«æ¨¡å¼æ™ºèƒ½åˆ‡æ¢
- æˆªå›¾è´¨é‡åŠ¨æ€è°ƒæ•´
- å¹¶å‘æµ‹è¯•æ”¯æŒ

## 13.3 èµ„æºç®¡ç†
- è¿‡æœŸèµ„æºè‡ªåŠ¨æ¸…ç†
- å‹ç¼©å›¾ç‰‡å­˜å‚¨
- å¼‚æ­¥æ—¥å¿—å†™å…¥

---

# 14. ç›‘æ§ä¸è°ƒè¯•

## 14.1 æ—¥å¿—ç³»ç»Ÿ
- åˆ†çº§æ—¥å¿—è®°å½• (DEBUG/INFO/WARN/ERROR)
- ç»“æ„åŒ–æ—¥å¿—æ ¼å¼
- æ—¥å¿—è½®è½¬å’Œå½’æ¡£

## 14.2 ç›‘æ§æŒ‡æ ‡
- LLM APIè°ƒç”¨ç»Ÿè®¡
- æµ‹è¯•æ‰§è¡Œæ—¶é—´åˆ†æ
- è®¾å¤‡è¿æ¥æˆåŠŸç‡
- è¯†åˆ«å‡†ç¡®ç‡ç»Ÿè®¡

## 14.3 è°ƒè¯•æ”¯æŒ
- è¯¦ç»†æ‰§è¡Œè½¨è¿¹
- æ–­ç‚¹è°ƒè¯•æ”¯æŒ
- å®æ—¶æ‰§è¡ŒçŠ¶æ€æŸ¥çœ‹
- èµ„æºæ–‡ä»¶å®Œæ•´ä¿å­˜

---

# 15. æ‰©å±•æ€§è®¾è®¡

## 15.1 LLMæä¾›å•†æ‰©å±•
```python
class CustomLLMProvider(BaseLLMProvider):
    def chat_completion(self, messages, **kwargs):
        # å®ç°è‡ªå®šä¹‰LLMæ¥å£
        pass
```

## 15.2 è¯†åˆ«å¼•æ“æ‰©å±•
```python
class CustomRecognitionEngine:
    def recognize_elements(self, screenshot):
        # å®ç°è‡ªå®šä¹‰è¯†åˆ«é€»è¾‘
        pass
```

## 15.3 æ¡ä»¶ç±»å‹æ‰©å±•
```json
{
  "condition": {
    "type": "custom_condition_type",
    "custom_params": {...}
  }
}
```

## 15.4 æŠ¥å‘Šæ ¼å¼æ‰©å±•
- HTMLæŠ¥å‘Šæ¨¡æ¿è‡ªå®šä¹‰
- JSONæŠ¥å‘Šå­—æ®µæ‰©å±•
- ç¬¬ä¸‰æ–¹æŠ¥å‘Šç³»ç»Ÿé›†æˆ

---

# 16. å®‰å…¨è®¾è®¡

## 16.1 æ•æ„Ÿä¿¡æ¯ä¿æŠ¤
- APIå¯†é’¥å­˜å‚¨åœ¨ç¯å¢ƒå˜é‡ä¸­
- é…ç½®æ–‡ä»¶ä¸åŒ…å«æ•æ„Ÿä¿¡æ¯
- Gitå¿½ç•¥ .env æ–‡ä»¶

## 16.2 æƒé™æ§åˆ¶
- æ–‡ä»¶è®¿é—®æƒé™æ£€æŸ¥
- APIè°ƒç”¨é¢‘ç‡é™åˆ¶
- è®¾å¤‡è¿æ¥å®‰å…¨éªŒè¯

---

# æ€»ç»“

Only-Test é€šè¿‡ç²¾å¿ƒè®¾è®¡çš„åˆ†å±‚æ¶æ„ï¼Œå®ç°äº†ï¼š

âœ… **é…ç½®é©±åŠ¨çš„ç»Ÿä¸€ç®¡ç†** - ä¸€æ¬¡é…ç½®ï¼Œå¤šå¤„ä½¿ç”¨  
âœ… **æ™ºèƒ½LLMé›†æˆ** - è‡ªç„¶è¯­è¨€ç›´æ¥ç”Ÿæˆæµ‹è¯•ç”¨ä¾‹  
âœ… **åŒæ¨¡è¯†åˆ«ç³»ç»Ÿ** - é™æ€å’ŒåŠ¨æ€UIçš„æ™ºèƒ½å¤„ç†  
âœ… **å®Œæ•´çš„æ‰§è¡Œè¿½æº¯** - æ¯ä¸ªæ“ä½œéƒ½æœ‰å®Œæ•´è®°å½•  
âœ… **é«˜åº¦å¯æ‰©å±•æ¶æ„** - æ”¯æŒè‡ªå®šä¹‰æ‰©å±•å„ä¸ªç»„ä»¶  
âœ… **ä¼ä¸šçº§å®‰å…¨æ€§** - æ•æ„Ÿä¿¡æ¯å®‰å…¨ä¿æŠ¤  
âœ… **ä¸“ä¸šåŒ–å·¥å…·é“¾** - ä»ç”Ÿæˆåˆ°æ‰§è¡Œåˆ°æŠ¥å‘Šçš„å®Œæ•´æµç¨‹

Only-Test æ¡†æ¶çš„æ ¸å¿ƒä»·å€¼ï¼š

1. **ğŸ§  æ™ºèƒ½åŒ–**ï¼šçœŸæ­£ç†è§£UIçŠ¶æ€ï¼Œæ™ºèƒ½é€‰æ‹©æ“ä½œè·¯å¾„
2. **ğŸ”„ è‡ªé€‚åº”**ï¼šè‡ªåŠ¨é€‚é…ä¸åŒåº”ç”¨å’Œè®¾å¤‡
3. **ğŸ“‹ æ ‡å‡†åŒ–**ï¼šç»Ÿä¸€çš„å…ƒæ•°æ®æ ¼å¼ï¼Œä¾¿äºç»´æŠ¤
4. **ğŸ¤– AIé©±åŠ¨**ï¼šLLMè¾…åŠ©ç”Ÿæˆï¼Œæé«˜å¼€å‘æ•ˆç‡
5. **ğŸ›¡ï¸ å¯é æ€§**ï¼šå¤šå±‚å¼‚å¸¸æ¢å¤ï¼Œç¡®ä¿æ‰§è¡Œç¨³å®š

é€šè¿‡æ™ºèƒ½å…ƒæ•°æ®å’Œæ¡ä»¶åˆ†æ”¯é€»è¾‘ï¼ŒçœŸæ­£å®ç°äº†"**Write Once, Test Everywhere**"çš„ç†å¿µï¼è¿™å°±æ˜¯çœŸæ­£é¢å‘æœªæ¥çš„ç§»åŠ¨ç«¯UIè‡ªåŠ¨åŒ–æµ‹è¯•æ¡†æ¶ï¼ğŸš€

---

**Happy Testing!** ğŸ¯